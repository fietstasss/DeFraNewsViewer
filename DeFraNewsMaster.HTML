<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DeFra News Master Player</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; background: #000; }
        iframe { width: 100vw; height: 100vh; border: none; display: block; }
    </style>
</head>
<body>
    <iframe id="master-frame" src="about:blank"></iframe>

    <script>
        /**
         * MASTER CONFIGURATION
         */
        const MASTER_CONFIG = {
            playlistUrl: "playlist.json", // The file Power Automate will update
            displayTimePerItem: 30000     // Default 30 seconds per news item
        };

        let playlist = [];
        let currentIndex = 0;
        const frame = document.getElementById('master-frame');

        // Function to fetch the latest playlist from GitHub
        async function updatePlaylist() {
            try {
                const response = await fetch(MASTER_CONFIG.playlistUrl + "?v=" + Date.now());
                const data = await response.json();
                playlist = data.articles || [];
                console.log("Playlist updated:", playlist);
            } catch (e) {
                console.error("Could not load playlist.json", e);
            }
        }

        async function playNext() {
            // Refresh playlist data when we start over
            if (currentIndex === 0) {
                await updatePlaylist();
            }

            if (playlist.length === 0) {
                document.body.innerHTML = "<h1 style='color:white; font-family:sans-serif; padding:50px;'>Wachten op berichten...</h1>";
                setTimeout(playNext, 5000);
                return;
            }

            const targetUrl = playlist[currentIndex];
            frame.src = targetUrl + (targetUrl.includes('?') ? '&' : '?') + "v=" + Date.now();

            currentIndex = (currentIndex + 1) % playlist.length;
        }

        // Start cycling
        setInterval(playNext, MASTER_CONFIG.displayTimePerItem);
        playNext();
    </script>
</body>
</html>
