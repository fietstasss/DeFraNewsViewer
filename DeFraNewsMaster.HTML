<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DeFra News Master Player</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; background: #000; }
        iframe { width: 100vw; height: 100vh; border: none; display: block; }
    </style>
</head>
<body>
    <div id="status"></div>
    <iframe id="master-frame" src="about:blank"></iframe>

    <script>
        // 1. Extract the playlist URL from the browser's address bar (?list=...)
        const urlParams = new URLSearchParams(window.location.search);
        const playlistSource = urlParams.get('list');
        const displayTime = parseInt(urlParams.get('time')) || 30000;

        let playlist = [];
        let currentIndex = 0;
        const frame = document.getElementById('master-frame');

        async function updatePlaylist() {
            if (!playlistSource) {
                document.getElementById('status').innerHTML = "<h2 style='color:red; font-family:sans-serif; padding:20px;'>Error: No 'list' parameter found in URL.</h2>";
                return;
            }

            try {
                // Fetch the JSON from the provided source
                const response = await fetch(playlistSource + (playlistSource.includes('?') ? '&' : '?') + "t=" + Date.now());
                const data = await response.json();
                playlist = data.articles || [];
            } catch (e) {
                console.error("Failed to load playlist", e);
            }
        }

        async function playNext() {
            if (currentIndex === 0) await updatePlaylist();

            if (playlist.length > 0) {
                const targetUrl = playlist[currentIndex];
                frame.src = targetUrl + (targetUrl.includes('?') ? '&' : '?') + "v=" + Date.now();
                currentIndex = (currentIndex + 1) % playlist.length;
            }
        }

        if (playlistSource) {
            setInterval(playNext, displayTime);
            playNext();
        } else {
            // Show instructions if no list is provided
            document.body.innerHTML = "<div style='color:white; font-family:sans-serif; padding:40px;'><h2>DeFra Master Loader</h2><p>Provide a playlist via the URL: ?list=[SharePointLink]</p></div>";
        }
    </script>
</body>
</html>
