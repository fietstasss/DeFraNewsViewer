<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
      /**
       * GLOBAL CONFIGURATION
       * Dashboard for all visual and logic settings
       */
      const VIEWER_CONFIG = {
        // --- TEXT SCROLL SETTINGS (NU DYNAMISCH) ---
        // pixelsPerSecond wordt nu genegeerd ten gunste van de Master-tijd
        pauseAtStart: 8000,        // Delay at the top (ms)
        pauseAtEnd: 5000,          // Delay at the bottom (ms)
        showTextProgress: true,    // Show/hide the vertical progress bar for text
        
        // --- TYPOGRAPHY & SPACING ---
        fontSizeText: "2.0rem",    // Grootte van de hoofdtekst
        fontSizeSubtitle: "3.0rem",// Grootte van de oranje titel
        contentPadding: "10px 60px",// Witruimte rondom de tekst
        
        // --- PHOTO SETTINGS (DYNAMISCH) ---
        startDelay: 1000,          // Delay before first photo pop-in (ms)
        staggerDelay: 600,         // Delay between first and second photo in grid (ms)
        imageRadius: "0px",         // Border radius for images (px)
        
        // --- VISUAL EFFECTS (THE DIALS) ---
        fadeSpeed: 1.5,            // Speed of the photo cross-fade (seconds)
        zoomScale: 1.05,           // How much the photo zooms in (1.05 = 5%)
        zoomDuration: 15,          // Time for a full zoom-cycle (seconds)
        photoShadow: 0.15,         // Shadow intensity (0 to 1)
        useAnimations: true        // Enable/disable fade-in effects
      };
    </script>
    <style>
      :root {
        /* UI Colors */
        --primary-blue: #1a4a7c;
        --accent-orange: #e67e22;
        --text-dark: #2c3e50;
        --white: #ffffff;
        --light-bg: #fcfcfc;
        --photo-bg: #f0f0f0;
      }

      /* --- BASE LAYOUT --- */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body,
      html {
        height: 100%;
        width: 100%;
        font-family: 'Segoe UI', sans-serif;
        background-color: var(--white);
        overflow: hidden;
      }

      .fullscreen-wrapper {
        display: flex;
        flex-direction: column;
        height: 100vh;
        width: 100vw;
        overflow: hidden;
      }

      /* Header Area */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 50px;
        height: 100px;
        background: var(--white);
        border-bottom: 2px solid #eee;
        flex-shrink: 0;
      }

      .logo {
        font-weight: 900;
        font-size: 2.5rem;
        color: var(--text-dark);
      }

      .main-title {
        font-size: 2.2rem;
        color: var(--text-dark);
        border-right: 8px solid var(--accent-orange);
        padding-right: 20px;
      }

      /* Meta Data Bar */
      .info-bar {
        background: linear-gradient(90deg, var(--primary-blue), #2c5e91);
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        color: white;
        padding: 0 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 1.2rem;
        flex-shrink: 0;
      }

      /* Content Grid */
      .main-content {
        display: grid;
        grid-template-columns: 45% 55%;
        flex: 1;
        min-height: 0;
        height: 0;
      }

      /* --- IMAGE SECTION (Left) --- */
      .image-side {
        position: relative;
        display: block;
        height: 100%;
        width: 100%;
        background-color: var(--photo-bg);
        overflow: hidden;
      }

      .image-item {
        position: absolute;
        width: 100%;
        height: 100%;
        object-fit: contain;
        transition: opacity var(--computed-fade-speed) ease-in-out; 
        opacity: 0;
        display: block;
        box-shadow: 0 0 25px rgba(0, 0, 0, var(--computed-shadow));
        border-radius: var(--image-radius); /* Pas de 20px aan naar smaak voor rondere of rechtere hoeken */
        overflow: hidden;    /* Zorgt ervoor dat de afbeelding echt binnen de ronde hoeken blijft */

      }

      .image-item.active {
        opacity: 1;
        animation: slowZoom var(--computed-zoom-duration) ease-in-out forwards;
      }

      .image-exit {
        opacity: 0 !important;
      }

      @keyframes slowZoom {
          0% { transform: scale(1.0); }
          100% { transform: scale(var(--computed-zoom-scale)); }
      }

      /* --- TEXT SECTION (Right) --- */
      .text-side {
        background-color: var(--light-bg);
        padding: var(--computed-padding);
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
      }

      .sub-header {
        font-size: var(--computed-subtitle-size);
        color: var(--accent-orange);
        font-weight: 800;
        margin-bottom: 20px;
        line-height: 1.1;
        flex-shrink: 0;
        z-index: 10;
        background: transparent;
        position: relative;
      }

      .scroll-window {
        flex-grow: 1;
        overflow: hidden;
        position: relative;
        margin-top: 0;
        -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 40px);
        mask-image: linear-gradient(to bottom, transparent 0%, black 40px);
      }

      .scroll-container {
        display: flex;
        flex-direction: column;
        width: 100%;
        padding-top: 10px;
      }

      .text-content {
        font-size: var(--computed-text-size);
        line-height: 1.7;
        color: var(--text-dark);
        white-space: pre-wrap;
      }

      .text-content p {
        margin-bottom: 40px;
      }

      /* --- VERTICAL TEXT PROGRESS INDICATOR --- */
      .text-progress-track {
        position: absolute;
        right: 20px;
        top: 60px;
        bottom: 60px;
        width: 4px;
        background: rgba(0, 0, 0, 0.05);
        border-radius: 2px;
        overflow: hidden;
        display: none;
      }

      .text-progress-bar {
        width: 100%;
        height: 0%;
        background: var(--accent-orange);
        border-radius: 2px;
      }

      /* --- CARROUSEL INDICATORS (Bottom) --- */
      .photo-indicators {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        z-index: 20;
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 8px 16px;
        border-radius: 20px;
        gap: 10px;
      }

      .indicator-segment {
        width: 35px;
        height: 3px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 2px;
        overflow: hidden;
        position: relative;
      }

      .indicator-segment.active::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        background: var(--white);
        animation: progressFill var(--photo-time) linear forwards;
      }

      @keyframes progressFill {
        from { width: 0%; }
        to { width: 100%; }
      }
    </style>
  </head>
  <body>
    <div class="fullscreen-wrapper">
      <header class="header">
        <div class="logo">DEFRA NEWS V6</div>
        <div class="main-title" id="view-title">Loading...</div>
      </header>
      <div class="info-bar">
        <span id="view-date"></span>
        <span id="view-authors"></span>        
      </div>
      <main class="main-content">
        <section class="image-side" id="image-display-area"></section>
        <article class="text-side">
          <h2 class="sub-header" id="view-subtitle"></h2>
          <div id="text-track" class="text-progress-track">
            <div id="text-progress-bar" class="text-progress-bar"></div>
          </div>
          <div class="scroll-window">
            <div class="scroll-container" id="scroll-target">
              <div class="text-content" id="view-text"></div>
            </div>
          </div>
        </article>
      </main>
    </div>
    <script>
      // Inject CSS variables from Config
      document.documentElement.style.setProperty('--computed-fade-speed', VIEWER_CONFIG.fadeSpeed + 's');
      document.documentElement.style.setProperty('--computed-zoom-duration', VIEWER_CONFIG.zoomDuration + 's');
      document.documentElement.style.setProperty('--computed-zoom-scale', VIEWER_CONFIG.zoomScale);
      document.documentElement.style.setProperty('--computed-shadow', VIEWER_CONFIG.photoShadow);
      document.documentElement.style.setProperty('--computed-text-size', VIEWER_CONFIG.fontSizeText);
      document.documentElement.style.setProperty('--computed-subtitle-size', VIEWER_CONFIG.fontSizeSubtitle);
      document.documentElement.style.setProperty('--computed-padding', VIEWER_CONFIG.contentPadding);
      document.documentElement.style.setProperty('--image-radius', VIEWER_CONFIG.imageRadius);

      window.onload = function() {
        window.parent.postMessage('READY', '*');
      };

      window.addEventListener('message', function(event) {
        if (event.data && event.data !== 'READY') {
          const data = event.data;
          
          document.getElementById('view-title').innerText = data.title || '';
          document.getElementById('view-subtitle').innerText = data.subtitle || '';
          const formattedContent = (data.content || '').replace(/\\n/g, '<br>').replace(/\n/g, '<br>');
          document.getElementById('view-text').innerHTML = formattedContent;
          // document.getElementById('view-date').innerText = data.date || '';
          // document.getElementById('view-authors').innerText = data.authors || '';
          if (data.date) {
            const datumObject = new Date(data.date);
            const opties = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            
            // Formatteer naar NL (bijv. woensdag 14 januari 2026)
            let datumTekst = datumObject.toLocaleDateString('nl-NL', opties);
            
            // Eerste letter hoofdletter maken
            datumTekst = datumTekst.charAt(0).toUpperCase() + datumTekst.slice(1);
            
            document.getElementById('view-date').innerText = "Nieuwsdatum: " + datumTekst;
          } else {
            document.getElementById('view-date').innerText = "";
          }

          // Auteurs met label
          document.getElementById('view-authors').innerText = "Auteur(s): " + (data.authors || 'Redactie Dekkers-Fransen');

          // 2. SMART SCROLL LOGIC (NU VOLLEDIG SYNCHROON MET MASTER)
          setTimeout(() => {
            const scrollContainer = document.getElementById('scroll-target');
            const scrollWindow = document.querySelector('.scroll-window');
            const progressBar = document.getElementById('text-progress-bar');
            const progressTrack = document.getElementById('text-track');
            const textHeight = scrollContainer.scrollHeight;
            const windowHeight = scrollWindow.offsetHeight;

            // Totale tijd van de Master (bijv. 30000ms)
            const masterTotalTime = data.displayTime || 30000;

            if (textHeight > windowHeight) {
              const distance = textHeight - windowHeight + 40;
              
              // We gebruiken de Master tijd als basis voor de totale animatie
              const totalDurationMs = masterTotalTime;
              const startPausePercent = (VIEWER_CONFIG.pauseAtStart / totalDurationMs) * 100;
              const endPausePercent = 100 - ((VIEWER_CONFIG.pauseAtEnd / totalDurationMs) * 100);
              
              if (VIEWER_CONFIG.showTextProgress) progressTrack.style.display = 'block';

              const styleId = 'dynamic-animations';
              let styleTag = document.getElementById(styleId);
              if (!styleTag) {
                styleTag = document.createElement('style');
                styleTag.id = styleId;
                document.head.appendChild(styleTag);
              }
              styleTag.innerHTML = `
                @keyframes dynamicAutoScroll {
                    0% { transform: translateY(0); }
                    ${startPausePercent}% { transform: translateY(0); }
                    ${endPausePercent}% { transform: translateY(-${distance}px); }
                    100% { transform: translateY(-${distance}px); }
                }
                @keyframes dynamicProgressHeight {
                    0% { height: 0%; }
                    ${startPausePercent}% { height: 0%; }
                    ${endPausePercent}% { height: 100%; }
                    100% { height: 100%; }
                }
                #scroll-target { animation: dynamicAutoScroll ${totalDurationMs / 1000}s linear infinite; }
                #text-progress-bar { animation: dynamicProgressHeight ${totalDurationMs / 1000}s linear infinite; }
              `;
            } else {
              scrollContainer.style.animation = "none";
              progressTrack.style.display = 'none';
            }
          }, 200);

          // 3. PHOTO DISPLAY & CAROUSEL LOGIC
          const container = document.getElementById('image-display-area');
          const photos = data.images || [];
          if (window.photoInterval) clearInterval(window.photoInterval);

          setTimeout(() => {
            container.innerHTML = '';
            if (photos.length === 0) {
              container.innerHTML = '<div style="background:var(--photo-bg); height:100%;"></div>';
              return;
            }

            let idx = 0;
            const masterDisplayTime = data.displayTime || 30000;
            const dynamicPhotoTime = masterDisplayTime / photos.length;

            const updateIndicators = (currentIdx) => {
              const existing = container.querySelector('.photo-indicators');
              if (existing) existing.remove();
              if (photos.length <= 1) return;

              const nav = document.createElement('div');
              nav.className = 'photo-indicators';
              photos.forEach((_, i) => {
                const seg = document.createElement('div');
                seg.className = 'indicator-segment';
                if (i === currentIdx) {
                  seg.classList.add('active');
                  seg.style.setProperty('--photo-time', `${dynamicPhotoTime}ms`);
                } else if (i < currentIdx) {
                  seg.style.background = 'rgba(255,255,255,0.8)';
                }
                nav.appendChild(seg);
              });
              container.appendChild(nav);
            };

            const rotate = () => {
              const oldImg = container.querySelector('.image-item:not(.image-exit)');
              const nextPhoto = photos[idx];
              const newImg = document.createElement('img');
              newImg.src = nextPhoto;
              newImg.className = 'image-item';
              newImg.style.zIndex = "1";

              newImg.onload = () => {
                container.appendChild(newImg);
                requestAnimationFrame(() => {
                  newImg.classList.add('active');
                  if (oldImg) {
                    oldImg.style.zIndex = "2";
                    oldImg.classList.add('image-exit');
                    setTimeout(() => oldImg.remove(), (VIEWER_CONFIG.fadeSpeed * 1000) + 100);
                  }
                });
                updateIndicators(idx);
                idx = (idx + 1) % photos.length;
              };
            };

            rotate();
            if (photos.length > 1) {
              window.photoInterval = setInterval(rotate, dynamicPhotoTime);
            }
          }, VIEWER_CONFIG.startDelay);
        }
      });
    </script>
  </body>
</html>