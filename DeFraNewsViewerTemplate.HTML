<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
      /**
       * GLOBAL CONFIGURATION
       * Dashboard for all visual and logic settings
       */
      const VIEWER_CONFIG = {
        // --- TEXT SCROLL SETTINGS ---
        pixelsPerSecond: 10, // Scrolling speed
        pauseAtStart: 4000, // Delay at the top (ms)
        pauseAtEnd: 5000, // Delay at the bottom (ms)
        showTextProgress: true, // Show/hide the vertical progress bar for text
        // --- PHOTO SETTINGS ---
        photoDisplayTime: 6000, // Duration per photo (ms)
        startDelay: 800, // Delay before first photo pop-in (ms)
        staggerDelay: 400, // Delay between first and second photo in grid (ms)
        useAnimations: true // Enable/disable fade-in effects
      };
    </script>
    <style>
      :root {
        /* UI Colors */
        --primary-blue: #1a4a7c;
        --accent-orange: #e67e22;
        --text-dark: #2c3e50;
        --white: #ffffff;
        --light-bg: #fcfcfc;
        --photo-bg: #f0f0f0;
        --fade-speed: 0.8s;
      }

      /* --- BASE LAYOUT --- */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body,
      html {
        height: 100%;
        width: 100%;
        font-family: 'Segoe UI', sans-serif;
        background-color: var(--white);
        overflow: hidden;
      }

      .fullscreen-wrapper {
        display: flex;
        flex-direction: column;
        height: 100vh;
        width: 100vw;
        overflow: hidden;
      }

      /* Header Area */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 50px;
        height: 100px;
        background: var(--white);
        border-bottom: 2px solid #eee;
        flex-shrink: 0;
      }

      .logo {
        font-weight: 900;
        font-size: 2.5rem;
        color: var(--text-dark);
      }

      .main-title {
        font-size: 2.2rem;
        color: var(--text-dark);
        border-right: 8px solid var(--accent-orange);
        padding-right: 20px;
      }

      /* Meta Data Bar */
      .info-bar {
        background-color: var(--primary-blue);
        color: white;
        padding: 0 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 1.2rem;
        flex-shrink: 0;
      }

      /* Content Grid */
      .main-content {
        display: grid;
        grid-template-columns: 45% 55%;
        flex: 1;
        min-height: 0;
        height: 0;
      }

      /* --- IMAGE SECTION (Left) --- */
      .image-side {
        position: relative;
        display: grid;
        height: 100%;
        width: 100%;
        background-color: var(--photo-bg);
        overflow: hidden;
      }

      .image-container {
        position: relative;
        width: 100%;
        height: 100%;
        min-height: 0;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .image-container img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        display: block;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        opacity: 0;
      }

      .fade-in {
        animation: fadeIn var(--fade-speed) forwards;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.98);
        }

        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      /* --- TEXT SECTION (Right) --- */
      .text-side {
        background-color: var(--light-bg);
        padding: 60px 80px;
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
      }

      .sub-header {
        font-size: 2.8rem;
        color: var(--accent-orange);
        font-weight: 800;
        margin-bottom: 30px;
        line-height: 1.2;
        flex-shrink: 0;
        z-index: 10;
      }

      .scroll-window {
        flex-grow: 1;
        overflow: hidden;
        position: relative;
      }

      .scroll-container {
        display: flex;
        flex-direction: column;
        width: 100%;
      }

      .text-content {
        font-size: 1.6rem;
        line-height: 1.8;
        color: var(--text-dark);
        white-space: pre-wrap;
      }

      .text-content p {
        margin-bottom: 40px;
      }

      /* --- VERTICAL TEXT PROGRESS INDICATOR --- */
      .text-progress-track {
        position: absolute;
        right: 20px;
        top: 60px;
        bottom: 60px;
        width: 4px;
        background: rgba(0, 0, 0, 0.05);
        border-radius: 2px;
        overflow: hidden;
        display: none;
        /* Hidden by default, JS enables it if needed */
      }

      .text-progress-bar {
        width: 100%;
        height: 0%;
        background: var(--accent-orange);
        border-radius: 2px;
      }

      /* --- CARROUSEL INDICATORS (Bottom) --- */
      .photo-indicators {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
        z-index: 20;
        background: rgba(0, 0, 0, 0.2);
        padding: 6px 12px;
        border-radius: 20px;
        backdrop-filter: blur(4px);
      }

      .indicator-segment {
        width: 30px;
        height: 4px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 2px;
        overflow: hidden;
        position: relative;
      }

      .indicator-segment.active::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        background: var(--white);
        animation: progressFill var(--photo-time) linear forwards;
      }

      @keyframes progressFill {
        from {
          width: 0%;
        }

        to {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="fullscreen-wrapper">
      <header class="header">
        <div class="logo">DEFRA NEWS</div>
        <div class="main-title" id="view-title">Loading...</div>
      </header>
      <div class="info-bar">
        <span id="view-date"></span>
        <span id="view-authors"></span>
      </div>
      <main class="main-content">
        <section class="image-side" id="image-display-area"></section>
        <article class="text-side">
          <h2 class="sub-header" id="view-subtitle"></h2>
          <div id="text-track" class="text-progress-track">
            <div id="text-progress-bar" class="text-progress-bar"></div>
          </div>
          <div class="scroll-window">
            <div class="scroll-container" id="scroll-target">
              <div class="text-content" id="view-text"></div>
            </div>
          </div>
        </article>
      </main>
    </div>
    <script>
      /**
       * Initial handshake with parent frame
       */
      window.onload = function() {
        window.parent.postMessage('READY', '*');
      };
      /**
       * Data Receiver and UI Generator
       */
      window.addEventListener('message', function(event) {
        if (event.data && event.data !== 'READY') {
          const data = event.data;
          // 1. FILL TEXT DATA
          document.getElementById('view-title').innerText = data.title || '';
          document.getElementById('view-subtitle').innerText = data.subtitle || '';
          document.getElementById('view-text').innerText = data.content || '';
          document.getElementById('view-date').innerText = data.date || '';
          document.getElementById('view-authors').innerText = data.authors || '';
          // 2. SMART SCROLL LOGIC & PROGRESS BAR
          setTimeout(() => {
            const scrollContainer = document.getElementById('scroll-target');
            const scrollWindow = document.querySelector('.scroll-window');
            const progressBar = document.getElementById('text-progress-bar');
            const progressTrack = document.getElementById('text-track');
            const textHeight = scrollContainer.scrollHeight;
            const windowHeight = scrollWindow.offsetHeight;
            if (textHeight > windowHeight) {
              const distance = textHeight - windowHeight + 40;
              const scrollDurationMs = (distance / VIEWER_CONFIG.pixelsPerSecond) * 1000;
              const totalDurationMs = scrollDurationMs + VIEWER_CONFIG.pauseAtStart + VIEWER_CONFIG.pauseAtEnd;
              // Calculation for animation percentages
              const startPausePercent = (VIEWER_CONFIG.pauseAtStart / totalDurationMs) * 100;
              const endPausePercent = 100 - ((VIEWER_CONFIG.pauseAtEnd / totalDurationMs) * 100);
              if (VIEWER_CONFIG.showTextProgress) progressTrack.style.display = 'block';
              // Inject Dynamic Keyframes for both text scroll and progress bar
              const styleId = 'dynamic-animations';
              let styleTag = document.getElementById(styleId);
              if (!styleTag) {
                styleTag = document.createElement('style');
                styleTag.id = styleId;
                document.head.appendChild(styleTag);
              }
              styleTag.innerHTML = `
                        @keyframes dynamicAutoScroll {
                            0% { transform: translateY(0); }
                            ${startPausePercent}% { transform: translateY(0); }
                            ${endPausePercent}% { transform: translateY(-${distance}px); }
                            100% { transform: translateY(-${distance}px); }
                        }
                        @keyframes dynamicProgressHeight {
                            0% { height: 0%; }
                            ${startPausePercent}% { height: 0%; }
                            ${endPausePercent}% { height: 100%; }
                            100% { height: 100%; }
                        }
                        #scroll-target { animation: dynamicAutoScroll ${totalDurationMs / 1000}s linear infinite; }
                        #text-progress-bar { animation: dynamicProgressHeight ${totalDurationMs / 1000}s linear infinite; }
                    `;
            } else {
              scrollContainer.style.animation = "none";
              progressTrack.style.display = 'none';
            }
          }, 200);
          // 3. PHOTO DISPLAY & CAROUSEL LOGIC
          const container = document.getElementById('image-display-area');
          const photos = data.images || [];
          if (window.photoInterval) clearInterval(window.photoInterval);
          // Create image element helper
          const renderPhoto = (src, delay = 0) => {
            const div = document.createElement('div');
            div.className = `image-container`;
            div.style.height = "100%";
            div.innerHTML = `
					<img src="${src}" class="${VIEWER_CONFIG.useAnimations ? 'fade-in' : ''}" style="animation-delay: ${delay}ms">`;
            return div;
          };
          // Delayed pop-in for visual appeal
          setTimeout(() => {
            container.innerHTML = '';
            if (photos.length === 0) {
              container.innerHTML = ' < div style = "background:var(--photo-bg); height:100%;" > < /div>';
            } else if (photos.length === 1) {
              container.style.display = "block";
              container.appendChild(renderPhoto(photos[0], 0));
            } else if (photos.length === 2) {
              container.style.display = "grid";
              container.style.gridTemplateRows = "1fr 1fr";
              container.appendChild(renderPhoto(photos[0], 0));
              container.appendChild(renderPhoto(photos[1], VIEWER_CONFIG.staggerDelay));
            } else {
              container.style.display = "block";
              let idx = 0;
              const updateIndicators = (currentIdx) => {
                const existing = container.querySelector('.photo-indicators');
                if (existing) existing.remove();
                const nav = document.createElement('div');
                nav.className = 'photo-indicators';
                photos.forEach((_, i) => {
                  const seg = document.createElement('div');
                  seg.className = 'indicator-segment';
                  if (i === currentIdx) {
                    seg.classList.add('active');
                    seg.style.setProperty('--photo-time', `${VIEWER_CONFIG.photoDisplayTime}ms`);
                  } else if (i < currentIdx) {
                    seg.style.background = 'rgba(255,255,255,0.8)';
                  }
                  nav.appendChild(seg);
                });
                container.appendChild(nav);
              };
              const rotate = () => {
                const oldImg = container.querySelector('.image-container');
                if (oldImg) oldImg.remove();
                container.prepend(renderPhoto(photos[idx], 0));
                updateIndicators(idx);
                idx = (idx + 1) % photos.length;
              };
              rotate();
              window.photoInterval = setInterval(rotate, VIEWER_CONFIG.photoDisplayTime);
            }
          }, VIEWER_CONFIG.startDelay);
        }
      });
    </script>
  </body>
</html>
